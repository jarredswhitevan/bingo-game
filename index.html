<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Game of Laura</title>

  <style>
    :root{
      --bg:#0b0f14;
      --panel:#121826;
      --tile:#0f172a;
      --border:rgba(255,255,255,.12);
      --text:#e5e7eb;
      --muted:#9ca3af;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:var(--bg);
      color:var(--text);
      min-height:100vh;
      padding:16px;
    }
    h1{text-align:center;margin:4px 0 10px}

    .controls{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px;
      display:grid;
      gap:10px;
      margin-bottom:12px;
    }
    .row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    label{
      font-size:14px;
      color:var(--muted);
      display:flex;
      align-items:center;
      gap:8px;
    }
    button,input[type="color"]{
      border-radius:10px;
      border:1px solid var(--border);
      background:#111827;
      color:var(--text);
      padding:8px 12px;
      font-size:14px;
      cursor:pointer;
    }
    button:hover{border-color:#6b7280}

    .grid{
      display:grid;
      grid-template-columns:repeat(5,1fr);
      gap:8px;
    }
    .tile{
      aspect-ratio:1/1;
      background:var(--tile);
      border:1px solid var(--border);
      border-radius:12px;
      padding:8px;
      text-align:center;
      font-size:13px;
      line-height:1.2;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      user-select:none;
      transition:transform .05s ease;
    }
    .tile:active{transform:scale(.97)}
    .marked{
      color:#000;
      font-weight:800;
    }
    .hint{
      color:var(--muted);
      font-size:12px;
      text-align:center;
      margin-top:10px;
    }
  </style>
</head>

<body>
  <h1>ðŸŽ¯ Game of Laura</h1>

  <div class="controls">
    <div class="row">
      <label>
        Mark color:
        <input type="color" id="colorPicker" value="#22c55e">
      </label>
      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <button id="shuffleBtn">Shuffle Card</button>
        <button id="clearBtn">Clear Marks</button>
        <button id="resetBtn">Reset Card</button>
      </div>
    </div>
  </div>

  <div id="grid" class="grid"></div>

  <div class="hint">
    FREE SPACE is always active Â· Progress saves automatically Â· Confirm before marking
  </div>

<script>
(() => {
  const PHRASES = [
    "Laura yells at tea",
    "Laura yells at Adie",
    "Boyfriend gets offended",
    "Laura cries",
    "Laura gets offended",
    "Laura tries to tell someone they are wrong",
    "Laura makes a big deal over secret Santa gifts",
    "David tries to impress everyone",
    "Laura dry begs",
    "Laura complains about not having money",
    "Laura complains about the food",
    "Laura complains about everyone drinking",
    "Laura is ungrateful",
    "Laura and pops argue",
    "Lauraâ€™s late",
    "Laura brings up Temu or SHEIN",
    "Laura brings up being the only real aunt",
    "Laura says sheâ€™s stressed",
    "Laura says nobody listens",
    "Laura corrects someone unnecessarily",
    "Laura sighs loudly",
    "Laura changes the topic to herself",
    "Laura guilt trips someone",
    "Laura ruins the vibe",
    "Laura repeats herself"
  ];

  const TOTAL = 25;
  const FREE_INDEX = 12;
  const STORAGE_KEY = "game_of_laura_final";

  const grid = document.getElementById("grid");
  const colorPicker = document.getElementById("colorPicker");

  function shuffle(arr){
    for(let i = arr.length - 1; i > 0; i--){
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function freshState(){
    const texts = shuffle([...PHRASES]);
    texts[FREE_INDEX] = "FREE SPACE";

    const marked = Array(TOTAL).fill(false);
    const colors = Array(TOTAL).fill(null);

    marked[FREE_INDEX] = true;
    colors[FREE_INDEX] = colorPicker.value;

    return { texts, marked, colors };
  }

  function isValidState(s){
    return s &&
      Array.isArray(s.texts) && s.texts.length === TOTAL &&
      Array.isArray(s.marked) && s.marked.length === TOTAL &&
      Array.isArray(s.colors) && s.colors.length === TOTAL;
  }

  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return null;
      const parsed = JSON.parse(raw);
      if(!isValidState(parsed)) return null;

      // enforce FREE SPACE always
      parsed.texts[FREE_INDEX] = "FREE SPACE";
      parsed.marked[FREE_INDEX] = true;
      parsed.colors[FREE_INDEX] ||= colorPicker.value;

      return parsed;
    } catch {
      return null;
    }
  }

  function saveState(){
    try{
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    } catch {}
  }

  let state = loadState() || freshState();

  function render(){
    grid.innerHTML = "";

    for(let i = 0; i < TOTAL; i++){
      const tile = document.createElement("div");
      tile.className = "tile";
      tile.textContent = state.texts[i];

      if(state.marked[i]){
        tile.classList.add("marked");
        tile.style.background = state.colors[i];
      }

      tile.addEventListener("click", () => toggleTile(i));
      grid.appendChild(tile);
    }

    saveState();
  }

  function toggleTile(i){
    if(i === FREE_INDEX) return;

    if(!state.marked[i]){
      if(!confirm("Mark this square?")) return;
      state.marked[i] = true;
      state.colors[i] = colorPicker.value;
    } else {
      if(!confirm("Unmark this square?")) return;
      state.marked[i] = false;
      state.colors[i] = null;
    }
    render();
  }

  document.getElementById("shuffleBtn").onclick = () => {
    if(!confirm("Shuffle card? This will reset marks.")) return;
    state = freshState();
    render();
  };

  document.getElementById("clearBtn").onclick = () => {
    if(!confirm("Clear all marks?")) return;
    state.marked = Array(TOTAL).fill(false);
    state.colors = Array(TOTAL).fill(null);

    state.marked[FREE_INDEX] = true;
    state.colors[FREE_INDEX] = colorPicker.value;

    render();
  };

  document.getElementById("resetBtn").onclick = () => {
    if(!confirm("Reset everything on this device?")) return;
    localStorage.removeItem(STORAGE_KEY);
    state = freshState();
    render();
  };

  render();
})();
</script>

</body>
</html>
